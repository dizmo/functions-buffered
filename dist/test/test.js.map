{"version":3,"sources":["test.js"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","Object","defineProperty","exports","chai_1","require","lib_1","describe","it","expect","buffered","to","not","be","an","a","fn","eq","key","bind","setTimeout","n","id","setInterval","clearInterval","t","dt","Date","getTime","p","res","Error","toString","catch","err","name","message","cancel"],"mappings":"AAAA;;AACA,IAAIA,YAAa,aAAQ,UAAKA,SAAd,IAA4B,UAAUC,OAAV,EAAmBC,UAAnB,EAA+BC,CAA/B,EAAkCC,SAAlC,EAA6C;AACrF,WAAO,KAAKD,MAAMA,IAAIE,OAAV,CAAL,EAAyB,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AACvD,iBAASC,SAAT,CAAmBC,KAAnB,EAA0B;AAAE,gBAAI;AAAEC,qBAAKN,UAAUO,IAAV,CAAeF,KAAf,CAAL;AAA8B,aAApC,CAAqC,OAAOG,CAAP,EAAU;AAAEL,uBAAOK,CAAP;AAAY;AAAE;AAC3F,iBAASC,QAAT,CAAkBJ,KAAlB,EAAyB;AAAE,gBAAI;AAAEC,qBAAKN,UAAU,OAAV,EAAmBK,KAAnB,CAAL;AAAkC,aAAxC,CAAyC,OAAOG,CAAP,EAAU;AAAEL,uBAAOK,CAAP;AAAY;AAAE;AAC9F,iBAASF,IAAT,CAAcI,MAAd,EAAsB;AAAEA,mBAAOC,IAAP,GAAcT,QAAQQ,OAAOL,KAAf,CAAd,GAAsC,IAAIN,CAAJ,CAAM,UAAUG,OAAV,EAAmB;AAAEA,wBAAQQ,OAAOL,KAAf;AAAwB,aAAnD,EAAqDO,IAArD,CAA0DR,SAA1D,EAAqEK,QAArE,CAAtC;AAAuH;AAC/IH,aAAK,CAACN,YAAYA,UAAUa,KAAV,CAAgBhB,OAAhB,EAAyBC,cAAc,EAAvC,CAAb,EAAyDS,IAAzD,EAAL;AACH,KALM,CAAP;AAMH,CAPD;AAQAO,OAAOC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C,EAAEX,OAAO,IAAT,EAA7C;AACA,IAAMY,SAASC,QAAQ,MAAR,CAAf;AACA,IAAMC,QAAQD,QAAQ,QAAR,CAAd;AACAA,QAAQ,iBAAR;AACAA,QAAQ,OAAR;AACAE,SAAS,UAAT,EAAqB,YAAM;AACvBC,OAAG,cAAH,EAAmB,YAAM;AACrBJ,eAAOK,MAAP,CAAcH,MAAMI,QAApB,EAA8BC,EAA9B,CAAiCC,GAAjC,CAAqCC,EAArC,CAAwCC,EAAxC,CAA2C,WAA3C;AACH,KAFD;AAGAN,OAAG,sBAAH,EAA2B,YAAM;AAC7BJ,eAAOK,MAAP,CAAcH,MAAMI,QAApB,EAA8BC,EAA9B,CAAiCE,EAAjC,CAAoCE,CAApC,CAAsC,UAAtC;AACH,KAFD;AAGH,CAPD;AAQAR,SAAS,UAAT,EAAqB,YAAM;AACvBC,OAAG,mCAAH,EAAwC,YAAM;AAC1C,YAAMQ,KAAKV,MAAMI,QAAN,CAAe,YAAM;AAC5BN,mBAAOK,MAAP,CAAc,IAAd,EAAoBE,EAApB,CAAuBM,EAAvB,CAA0B,IAA1B;AACH,SAFU,CAAX;AAGAb,eAAOK,MAAP,CAAcO,EAAd,EAAkBL,EAAlB,CAAqBE,EAArB,CAAwBE,CAAxB,CAA0B,UAA1B;AACH,KALD;AAMAP,OAAG,kCAAH,EAAuC,UAACV,IAAD,EAAU;AAC7CQ,cAAMI,QAAN,CAAe,YAAY;AACvBN,mBAAOK,MAAP,CAAc,IAAd,EAAoBE,EAApB,CAAuBE,EAAvB,CAA0BC,EAA1B,CAA6B,WAA7B;AACH,SAFD,EAEG,CAFH;AAGAR,cAAMI,QAAN,CAAe,YAAY;AACvBN,mBAAOK,MAAP,CAAc,IAAd,EAAoBE,EAApB,CAAuBE,EAAvB,CAA0BC,EAA1B,CAA6B,QAA7B;AACAV,mBAAOK,MAAP,CAAc,KAAKS,GAAnB,EAAwBP,EAAxB,CAA2BM,EAA3B,CAA8B,IAA9B;AACH,SAHc,CAGbE,IAHa,CAGR,EAAED,KAAK,IAAP,EAHQ,CAAf,EAGuB,CAHvB;AAIAE,mBAAWtB,IAAX,EAAiB,CAAjB;AACH,KATD;AAUAU,OAAG,2BAAH,EAAgC,UAACV,IAAD,EAAU;AACtC,YAAIuB,IAAI,CAAR;AACA,YAAML,KAAKV,MAAMI,QAAN,CAAe,YAAM;AAC5BW,iBAAK,CAAL;AACH,SAFU,EAER,CAFQ,CAAX;AAGAjB,eAAOK,MAAP,CAAcY,CAAd,EAAiBV,EAAjB,CAAoBM,EAApB,CAAuB,CAAvB;AACAb,eAAOK,MAAP,CAAcO,EAAd,EAAkBL,EAAlB,CAAqBE,EAArB,CAAwBE,CAAxB,CAA0B,UAA1B;AACA,YAAMO,KAAKC,YAAY,YAAM;AACzBnB,mBAAOK,MAAP,CAAcY,CAAd,EAAiBV,EAAjB,CAAoBM,EAApB,CAAuB,CAAvB;AACAD;AACAA;AACAA;AACAZ,mBAAOK,MAAP,CAAcY,CAAd,EAAiBV,EAAjB,CAAoBM,EAApB,CAAuB,CAAvB;AACH,SANU,EAMR,CANQ,CAAX;AAOAG,mBAAW,YAAM;AACbhB,mBAAOK,MAAP,CAAcY,CAAd,EAAiBV,EAAjB,CAAoBM,EAApB,CAAuB,CAAvB;AACAO,0BAAcF,EAAd;AACAlB,mBAAOK,MAAP,CAAcY,CAAd,EAAiBV,EAAjB,CAAoBM,EAApB,CAAuB,CAAvB;AACAG,uBAAW,YAAM;AACbhB,uBAAOK,MAAP,CAAcY,CAAd,EAAiBV,EAAjB,CAAoBM,EAApB,CAAuB,CAAvB;AACH,aAFD,EAEG,CAFH;AAGAb,mBAAOK,MAAP,CAAcY,CAAd,EAAiBV,EAAjB,CAAoBM,EAApB,CAAuB,CAAvB;AACAG,uBAAW,YAAM;AACbhB,uBAAOK,MAAP,CAAcY,CAAd,EAAiBV,EAAjB,CAAoBM,EAApB,CAAuB,CAAvB;AACAnB;AACH,aAHD,EAGG,CAHH;AAIAM,mBAAOK,MAAP,CAAcY,CAAd,EAAiBV,EAAjB,CAAoBM,EAApB,CAAuB,CAAvB;AACH,SAbD,EAaG,CAbH;AAcH,KA5BD;AA6BAT,OAAG,0BAAH,EAA+B,UAACV,IAAD,EAAU;AACrCQ,cAAMI,QAAN,CAAe,UAACe,CAAD,EAAO;AAClB,gBAAMC,KAAK,IAAIC,IAAJ,GAAWC,OAAX,KAAuBH,EAAEG,OAAF,EAAlC;AACAxB,mBAAOK,MAAP,CAAciB,MAAM,CAApB,EAAuBf,EAAvB,CAA0BM,EAA1B,CAA6B,IAA7B;AACAnB;AACH,SAJD,EAIG,CAJH,EAIM,IAAI6B,IAAJ,EAJN;AAKH,KAND;AAOAnB,OAAG,yBAAH,EAA8B,UAACV,IAAD,EAAU;AACpC,YAAMkB,KAAKV,MAAMI,QAAN,CAAe,UAACe,CAAD,EAAO;AAC7B,mBAAO,IAAIE,IAAJ,GAAWC,OAAX,KAAuBH,CAA9B;AACH,SAFU,EAER,CAFQ,CAAX;AAGA,YAAMI,IAAIb,GAAG,IAAIW,IAAJ,GAAWC,OAAX,EAAH,CAAV;AACAxB,eAAOK,MAAP,CAAcoB,CAAd,EAAiBlB,EAAjB,CAAoBE,EAApB,CAAuBE,CAAvB,CAAyB,SAAzB;AACAc,UAAE9B,IAAF,CAAO,UAAC+B,GAAD,EAAS;AACZ1B,mBAAOK,MAAP,CAAcqB,OAAO,CAArB,EAAwBnB,EAAxB,CAA2BM,EAA3B,CAA8B,IAA9B;AACA,kBAAM,IAAIc,KAAJ,CAAUD,IAAIE,QAAJ,EAAV,CAAN;AACH,SAHD,EAGGC,KAHH,CAGS,UAACC,GAAD,EAAS;AACd9B,mBAAOK,MAAP,CAAcyB,IAAIC,IAAlB,EAAwBxB,EAAxB,CAA2BM,EAA3B,CAA8B,OAA9B;AACAb,mBAAOK,MAAP,CAAcyB,IAAIE,OAAlB,EAA2BzB,EAA3B,CAA8BE,EAA9B,CAAiCE,CAAjC,CAAmC,QAAnC;AACAX,mBAAOK,MAAP,CAAcyB,IAAIE,OAAJ,IAAe,GAA7B,EAAkCzB,EAAlC,CAAqCM,EAArC,CAAwC,IAAxC;AACH,SAPD;AAQAG,mBAAWtB,IAAX,EAAiB,CAAjB;AACH,KAfD;AAgBAU,OAAG,uBAAH,EAA4B;AAAA,eAAMzB,qBAAgB,KAAK,CAArB,EAAwB,KAAK,CAA7B,uCAAgC;AAAA;AAAA;AAAA;AAAA;AAAA;AACxDiC,8BADwD,GACnDV,MAAMI,QAAN,CAAe,UAACe,CAAD,EAAO;AAC7B,uCAAO,IAAIE,IAAJ,KAAaF,CAApB;AACH,6BAFU,EAER,CAFQ,CADmD;AAAA;AAAA,mCAI7CT,GAAG,IAAIW,IAAJ,EAAH,CAJ6C;;AAAA;AAIxDD,8BAJwD;;AAK9DtB,mCAAOK,MAAP,CAAciB,EAAd,EAAkBf,EAAlB,CAAqBE,EAArB,CAAwBE,CAAxB,CAA0B,QAA1B;AACAX,mCAAOK,MAAP,CAAciB,MAAM,CAApB,EAAuBf,EAAvB,CAA0BM,EAA1B,CAA6B,IAA7B;;AAN8D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAhC,EAAN;AAAA,KAA5B;AAQAT,OAAG,qCAAH,EAA0C,YAAM;AAC5C,YAAMQ,KAAKV,MAAMI,QAAN,CAAe,YAAM;AAC5BN,mBAAOK,MAAP,CAAc,IAAd,EAAoBE,EAApB,CAAuBM,EAAvB,CAA0B,IAA1B;AACH,SAFU,CAAX;AAGAb,eAAOK,MAAP,CAAcO,EAAd,EAAkBL,EAAlB,CAAqBE,EAArB,CAAwBE,CAAxB,CAA0B,UAA1B;AACAX,eAAOK,MAAP,CAAcO,GAAGqB,MAAjB,EAAyB1B,EAAzB,CAA4BE,EAA5B,CAA+BE,CAA/B,CAAiC,UAAjC;AACH,KAND;AAOAP,OAAG,2BAAH,EAAgC,YAAM;AAClC,YAAMQ,KAAKV,MAAMI,QAAN,CAAe,YAAM;AAC5BN,mBAAOK,MAAP,CAAc,IAAd,EAAoBE,EAApB,CAAuBM,EAAvB,CAA0B,KAA1B;AACH,SAFU,EAER,CAFQ,CAAX;AAGAD;AACAA;AACAA;AACAA,WAAGqB,MAAH;AACH,KARD;AASH,CA7FD","file":"test.js","sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst chai_1 = require(\"chai\");\nconst lib_1 = require(\"../lib\");\nrequire(\"@babel/polyfill\");\nrequire(\"mocha\");\ndescribe(\"buffered\", () => {\n    it(\"should exist\", () => {\n        chai_1.expect(lib_1.buffered).to.not.be.an(\"undefined\");\n    });\n    it(\"should be a function\", () => {\n        chai_1.expect(lib_1.buffered).to.be.a(\"function\");\n    });\n});\ndescribe(\"buffered\", () => {\n    it(\"should return a buffered function\", () => {\n        const fn = lib_1.buffered(() => {\n            chai_1.expect(true).to.eq(true);\n        });\n        chai_1.expect(fn).to.be.a(\"function\");\n    });\n    it(\"should preserve `this` correctly\", (done) => {\n        lib_1.buffered(function () {\n            chai_1.expect(this).to.be.an(\"undefined\");\n        }, 1)();\n        lib_1.buffered(function () {\n            chai_1.expect(this).to.be.an(\"object\");\n            chai_1.expect(this.key).to.eq(true);\n        }.bind({ key: true }), 1)();\n        setTimeout(done, 1);\n    });\n    it(\"should buffer invocations\", (done) => {\n        let n = 0;\n        const fn = lib_1.buffered(() => {\n            n += 1;\n        }, 5);\n        chai_1.expect(n).to.eq(0);\n        chai_1.expect(fn).to.be.a(\"function\");\n        const id = setInterval(() => {\n            chai_1.expect(n).to.eq(0);\n            fn();\n            fn();\n            fn();\n            chai_1.expect(n).to.eq(0);\n        }, 1);\n        setTimeout(() => {\n            chai_1.expect(n).to.eq(0);\n            clearInterval(id);\n            chai_1.expect(n).to.eq(0);\n            setTimeout(() => {\n                chai_1.expect(n).to.eq(0);\n            }, 1);\n            chai_1.expect(n).to.eq(0);\n            setTimeout(() => {\n                chai_1.expect(n).to.eq(1);\n                done();\n            }, 5);\n            chai_1.expect(n).to.eq(0);\n        }, 5);\n    });\n    it(\"should forward arguments\", (done) => {\n        lib_1.buffered((t) => {\n            const dt = new Date().getTime() - t.getTime();\n            chai_1.expect(dt >= 0).to.eq(true);\n            done();\n        }, 1)(new Date());\n    });\n    it(\"should return a promise\", (done) => {\n        const fn = lib_1.buffered((t) => {\n            return new Date().getTime() - t;\n        }, 1);\n        const p = fn(new Date().getTime());\n        chai_1.expect(p).to.be.a(\"Promise\");\n        p.then((res) => {\n            chai_1.expect(res >= 0).to.eq(true);\n            throw new Error(res.toString());\n        }).catch((err) => {\n            chai_1.expect(err.name).to.eq(\"Error\");\n            chai_1.expect(err.message).to.be.a(\"string\");\n            chai_1.expect(err.message >= \"0\").to.eq(true);\n        });\n        setTimeout(done, 1);\n    });\n    it(\"should await a result\", () => __awaiter(this, void 0, void 0, function* () {\n        const fn = lib_1.buffered((t) => {\n            return new Date() - t;\n        }, 1);\n        const dt = yield fn(new Date());\n        chai_1.expect(dt).to.be.a(\"number\");\n        chai_1.expect(dt >= 0).to.eq(true);\n    }));\n    it(\"should return a cancelable function\", () => {\n        const fn = lib_1.buffered(() => {\n            chai_1.expect(true).to.eq(true);\n        });\n        chai_1.expect(fn).to.be.a(\"function\");\n        chai_1.expect(fn.cancel).to.be.a(\"function\");\n    });\n    it(\"should cancel invocations\", () => {\n        const fn = lib_1.buffered(() => {\n            chai_1.expect(true).to.eq(false);\n        }, 1);\n        fn();\n        fn();\n        fn();\n        fn.cancel();\n    });\n});\n"]}