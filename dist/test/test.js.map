{"version":3,"sources":["test.js"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","Object","defineProperty","exports","chai_1","require","lib_1","describe","it","expect","buffered","to","not","be","an","a","fn","eq","key","bind","setTimeout","n","id","setInterval","clearInterval","t","dt","Date","getTime","p","res","Error","toString","err","name","message","cancel"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst chai_1 = require(\"chai\");\nconst lib_1 = require(\"../lib\");\nrequire(\"@babel/polyfill\");\nrequire(\"mocha\");\ndescribe(\"buffered\", () => {\n    it(\"should exist\", () => {\n        chai_1.expect(lib_1.buffered).to.not.be.an(\"undefined\");\n    });\n    it(\"should be a function\", () => {\n        chai_1.expect(lib_1.buffered).to.be.a(\"function\");\n    });\n});\ndescribe(\"buffered\", () => {\n    it(\"should return a buffered function\", () => {\n        const fn = lib_1.buffered(() => {\n            chai_1.expect(true).to.eq(true);\n        });\n        chai_1.expect(fn).to.be.a(\"function\");\n    });\n    it(\"should preserve `this` correctly\", (done) => {\n        lib_1.buffered(function () {\n            chai_1.expect(this).to.be.an(\"undefined\");\n        }, 1)();\n        lib_1.buffered(function () {\n            chai_1.expect(this).to.be.an(\"object\");\n            chai_1.expect(this.key).to.eq(true);\n        }.bind({ key: true }), 1)();\n        setTimeout(done, 1);\n    });\n    it(\"should buffer invocations\", (done) => {\n        let n = 0;\n        const fn = lib_1.buffered(() => {\n            n += 1;\n        }, 5);\n        chai_1.expect(n).to.eq(0);\n        chai_1.expect(fn).to.be.a(\"function\");\n        const id = setInterval(() => {\n            chai_1.expect(n).to.eq(0);\n            fn();\n            fn();\n            fn();\n            chai_1.expect(n).to.eq(0);\n        }, 1);\n        setTimeout(() => {\n            chai_1.expect(n).to.eq(0);\n            clearInterval(id);\n            chai_1.expect(n).to.eq(0);\n            setTimeout(() => {\n                chai_1.expect(n).to.eq(0);\n            }, 1);\n            chai_1.expect(n).to.eq(0);\n            setTimeout(() => {\n                chai_1.expect(n).to.eq(1);\n                done();\n            }, 5);\n            chai_1.expect(n).to.eq(0);\n        }, 5);\n    });\n    it(\"should forward arguments\", (done) => {\n        lib_1.buffered((t) => {\n            const dt = new Date().getTime() - t.getTime();\n            chai_1.expect(dt >= 0).to.eq(true);\n            done();\n        }, 1)(new Date());\n    });\n    it(\"should return a promise\", (done) => {\n        const fn = lib_1.buffered((t) => {\n            return new Date().getTime() - t;\n        }, 1);\n        const p = fn(new Date().getTime());\n        chai_1.expect(p).to.be.a(\"Promise\");\n        p.then((res) => {\n            chai_1.expect(res >= 0).to.eq(true);\n            throw new Error(res.toString());\n        }).catch((err) => {\n            chai_1.expect(err.name).to.eq(\"Error\");\n            chai_1.expect(err.message).to.be.a(\"string\");\n            chai_1.expect(err.message >= \"0\").to.eq(true);\n        });\n        setTimeout(done, 1);\n    });\n    it(\"should await a result\", () => __awaiter(this, void 0, void 0, function* () {\n        const fn = lib_1.buffered((t) => {\n            return new Date() - t;\n        }, 1);\n        const dt = yield fn(new Date());\n        chai_1.expect(dt).to.be.a(\"number\");\n        chai_1.expect(dt >= 0).to.eq(true);\n    }));\n    it(\"should return a cancelable function\", () => {\n        const fn = lib_1.buffered(() => {\n            chai_1.expect(true).to.eq(true);\n        });\n        chai_1.expect(fn).to.be.a(\"function\");\n        chai_1.expect(fn.cancel).to.be.a(\"function\");\n    });\n    it(\"should cancel invocations\", () => {\n        const fn = lib_1.buffered(() => {\n            chai_1.expect(true).to.eq(false);\n        }, 1);\n        fn();\n        fn();\n        fn();\n        fn.cancel();\n    });\n});\n"],"file":"test.js"}