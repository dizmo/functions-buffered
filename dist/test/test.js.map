{"version":3,"sources":["test.js"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","Object","defineProperty","exports","index_1","require","chai_1","describe","it","expect","buffered","to","exist","be","a","fn","an","key","equal","bind","setTimeout","n","id","setInterval","clearInterval","t","Date","p","res","Error","toString","catch","err","name","message","dt","cancel"],"mappings":"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","file":"test.js","sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst index_1 = require(\"../lib/index\");\nconst chai_1 = require(\"chai\");\nrequire(\"mocha\");\ndescribe('index.buffered', () => {\n    it('should exist', () => {\n        chai_1.expect(index_1.buffered).to.exist;\n    });\n    it('should be a function', () => {\n        chai_1.expect(index_1.buffered).to.be.a('function');\n    });\n});\ndescribe('index.buffered', () => {\n    it('should return a buffered function', () => {\n        let fn = index_1.buffered(() => { });\n        chai_1.expect(fn).to.be.a('function');\n    });\n    it('should preserve `this` correctly', (done) => {\n        index_1.buffered(function () {\n            chai_1.expect(this).to.be.an('undefined');\n        }, 1)();\n        index_1.buffered(function () {\n            chai_1.expect(this).to.be.an('object');\n            chai_1.expect(this.key).to.equal(true);\n        }.bind({ key: true }), 1)();\n        setTimeout(done, 1);\n    });\n    it('should buffer invocations', (done) => {\n        let n = 0, fn = index_1.buffered(() => {\n            n += 1;\n        }, 5);\n        chai_1.expect(n).to.equal(0);\n        chai_1.expect(fn).to.be.a('function');\n        let id = setInterval(() => {\n            chai_1.expect(n).to.equal(0);\n            fn();\n            fn();\n            fn();\n            chai_1.expect(n).to.equal(0);\n        }, 1);\n        setTimeout(() => {\n            chai_1.expect(n).to.equal(0);\n            clearInterval(id);\n            chai_1.expect(n).to.equal(0);\n            setTimeout(() => {\n                chai_1.expect(n).to.equal(0);\n            }, 1);\n            chai_1.expect(n).to.equal(0);\n            setTimeout(() => {\n                chai_1.expect(n).to.equal(1);\n                done();\n            }, 5);\n            chai_1.expect(n).to.equal(0);\n        }, 5);\n    });\n    it('should forward arguments', (done) => {\n        index_1.buffered(function (t) {\n            chai_1.expect(new Date() - t >= 0).to.equal(true);\n        }, 1)(new Date());\n        setTimeout(done, 1);\n    });\n    it('should return a promise', (done) => {\n        let fn = index_1.buffered(function (t) {\n            return new Date() - t;\n        }, 1);\n        let p = fn(new Date());\n        chai_1.expect(p).to.be.a('Promise');\n        p.then((res) => {\n            chai_1.expect(res >= 0).to.equal(true);\n            throw new Error(res.toString());\n        }).catch((err) => {\n            chai_1.expect(err.name).to.equal('Error');\n            chai_1.expect(err.message).to.be.a('string');\n            chai_1.expect(err.message >= '0').to.equal(true);\n        });\n        setTimeout(done, 1);\n    });\n    it('should await a result', () => __awaiter(this, void 0, void 0, function* () {\n        let fn = index_1.buffered(function (t) {\n            return new Date() - t;\n        }, 1);\n        let dt = yield fn(new Date());\n        chai_1.expect(dt).to.be.a('number');\n        chai_1.expect(dt >= 0).to.equal(true);\n    }));\n    it('should return a cancelable function', () => {\n        let fn = index_1.buffered(() => { });\n        chai_1.expect(fn).to.be.a('function');\n        chai_1.expect(fn.cancel).to.be.a('function');\n    });\n    it('should cancel invocations', () => {\n        let fn = index_1.buffered(() => {\n            chai_1.expect(true).to.equal(false);\n        }, 1);\n        fn();\n        fn();\n        fn();\n        fn.cancel();\n    });\n});\n"]}